<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>React CRUD Clientes - Tutorial Paso a Paso</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        html, body {height:100%; margin:0}
        body{display:flex; flex-direction:column}
        main{flex:1 0 auto}
        footer{flex-shrink:0}
        /* Header shared styles (from index) */
        header { overflow: visible; padding-top: env(safe-area-inset-top); }
        :root { --header-offset: 9.5rem; }
        .logo-wrap { display:flex; align-items:center; gap:0.75rem; }
        .logo-circle { border-radius:9999px; background:rgba(255,255,255,0.08); display:flex; align-items:center; justify-content:center; }
        .logo-circle { padding:0.5rem; width:64px; height:64px; }
        .brand-title { font-size:1.375rem; }
        .brand-sub { font-size:0.875rem; }
        @media(min-width:640px){ .logo-circle { padding:0.75rem; width:80px; height:80px; } .brand-title { font-size:1.75rem; } .brand-sub { font-size:0.95rem; } }
        @media(min-width:1024px){ .logo-circle { padding:1rem; width:96px; height:96px; } .brand-title { font-size:2.25rem; } .brand-sub { font-size:1rem; } }

        /* Editor-like code block (similar to tema11) */
        .code-editor { position: relative; padding: 0.75rem; background: linear-gradient(180deg,#07101a 0%, #0b1220 100%); border-radius: 10px; border: 1px solid rgba(255,255,255,0.04); color: #e6eef8; margin-bottom: 1rem; }
        .code-toolbar { padding: 0.35rem 0.6rem; background: transparent; display:flex; align-items:center; gap:.6rem; }
        .file-label { color:#9aa8bb; font-weight:600; font-size:0.95rem; }
        .code-editor pre { background: transparent; color: #dbe7f6; font-size:0.95rem; line-height:1.6; padding: .6rem; margin:0; overflow:auto; border-radius:6px; font-family: 'Fira Code', 'Courier New', monospace; }
        .code-editor .copy-btn { margin-left: 8px; background: rgba(255,255,255,0.03); color:#cfe8ff; border:1px solid rgba(255,255,255,0.04); padding:6px 10px; border-radius:6px; cursor:pointer; font-weight:600; font-size:0.85rem; }
        .code-editor .copy-btn:active { transform: translateY(1px); }
        .code-editor .copy-btn:focus { outline: 2px solid rgba(125,211,252,0.18); }
        @media (max-width: 640px) { .code-editor pre { font-size:0.85rem; } .file-label { font-size:0.82rem; } }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800">
<!-- Unified header with lesson title -->
<header class="bg-gradient-to-r from-blue-700 via-cyan-600 to-indigo-700 text-white py-8 sm:py-12 md:py-16 lg:py-20 sticky top-0 z-50 shadow-lg">
    <div class="container mx-auto px-4">
        <div class="flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="logo-wrap animate-fade-in-down">
                <div class="logo-circle">
                    <i class="fab fa-react text-cyan-200" style="font-size:2rem"></i>
                </div>
                <div>
                    <div class="brand-title font-extrabold leading-tight">Curso de Frontend - Desarrollo de software</div>
                    <p class="brand-sub mt-1 text-cyan-100/90">Guía práctica — Arle Morales Ortiz</p>
                </div>
            </div>

            <div class="text-right">
                <h1 class="text-2xl md:text-4xl font-extrabold">8. CRUD Clientes + API REST</h1>
                <div class="mt-2">
                    <a href="/src/index.html#topics" class="inline-flex items-center gap-2 bg-white shadow-sm text-blue-700 px-3 py-2 rounded-full text-sm md:text-base hover:brightness-95 focus-ring" aria-label="Ver temas">
                        <i class="fa-solid fa-book-open"></i>
                        <span>Ver Temas</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</header>

<main class="container mx-auto px-4 py-10 section-offset">
    <section class="bg-white rounded-2xl shadow p-6 md:p-8">
        <h2 class="text-2xl md:text-3xl font-semibold text-blue-800 mb-4 flex items-center gap-3"><i class="fa-solid fa-network-wired"></i> Tutorial paso a paso — Cliente HTTP en React (CRUD)</h2>

        <p class="text-gray-700 mb-4">En este tutorial crearemos un cliente HTTP en React para realizar operaciones CRUD (Create, Read, Update, Delete) contra una API REST. Cubrimos setup, implementación con <code>fetch</code> y <code>axios</code>, componentes, manejo de errores, optimizaciones y pruebas.</p>

        <h3 class="text-lg font-semibold text-blue-700 mt-6">1) Setup del proyecto</h3>
        <p class="text-gray-700">Crea una app con Vite (recomendada) o Create React App. Instalaremos Tailwind para estilos y <code>axios</code> como cliente opcional.</p>
        <div class="codecard editor-bg rounded-xl p-4 mb-4">
            <div class="editor-code">
                <span class="com"># Terminal (Vite)</span><br>
                <span class="kw">npm</span> <span class="fn">create</span> <span class="str">vite@latest</span> <span class="var">cliente-crud</span> <span class="str">-- --template react</span><br>
                <span class="kw">cd</span> <span class="var">cliente-crud</span><br>
                <span class="kw">npm</span> <span class="fn">install</span><br>
                <span class="kw">npm</span> <span class="fn">install</span> <span class="str">axios</span> <span class="str">tailwindcss</span>
            </div>
        </div>

        <h3 class="text-lg font-semibold text-blue-700 mt-6">2) Cliente de API (api.js)</h3>
        <p class="text-gray-700">Creamos un archivo <code>src/api.js</code> que encapsule las llamadas HTTP. Usaremos <code>fetch</code> y también mostraremos la versión con <code>axios</code>. Además añadimos manejo básico de errores y timeout con AbortController.</p>

        <div class="code-editor">
            <div class="code-toolbar"><span class="file-label">src/api.js</span></div>
            <pre><code class="language-js">// src/api.js (fetch + AbortController)
const BASE = '/api/clientes';

export async function request(path, opts = {}) {
  const { signal } = opts;
  try {
    const res = await fetch(BASE + path, opts);
    if (!res.ok) {
      const txt = await res.text();
      throw new Error(`HTTP ${res.status} - ${txt || res.statusText}`);
    }
    return await res.json();
  } catch (e) {
    if (e.name === 'AbortError') throw e;
    console.error('api request error', e);
    throw e;
  }
}

export async function getClientes(signal) { return await request('/', { method: 'GET', signal }); }
export async function crearCliente(payload) { return await request('/', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); }
export async function actualizarCliente(id, payload) { return await request(`/${id}`, { method: 'PUT', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); }
export async function borrarCliente(id) { return await request(`/${id}`, { method: 'DELETE' }); }
</code></pre>
        </div>

        <h3 class="text-lg font-semibold text-blue-700 mt-6">3) Componentes: ClienteForm y ClienteList</h3>
        <p class="text-gray-700">Implementaremos dos componentes: un formulario controlado para crear/editar (<code>ClienteForm.jsx</code>) y una lista con acciones (<code>ClienteList.jsx</code>).</p>

        <div class="codecard editor-bg rounded-xl p-4 mb-4">
            <div class="editor-code">
                <span class="com">// src/ClienteForm.jsx</span><br>
                <span class="kw">import</span> { <span class="var">useState</span>, <span class="var">useEffect</span> } <span class="kw">from</span> <span class="str">'react'</span>;<br>
                <span class="kw">export default function</span> <span class="fn">ClienteForm</span>({ <span class="var">onSave</span>, <span class="var">initial</span> = null }) {<br>
                &nbsp;&nbsp;<span class="kw">const</span> [<span class="var">nombre</span>, <span class="var">setNombre</span>] = <span class="fn">useState</span>(<span class="str">''</span>);<br>
                &nbsp;&nbsp;<span class="kw">const</span> [<span class="var">email</span>, <span class="var">setEmail</span>] = <span class="fn">useState</span>(<span class="str">''</span>);<br>

                &nbsp;&nbsp;<span class="fn">useEffect</span>(() =&gt; { if(initial){ setNombre(initial.nombre||''); setEmail(initial.email||''); } else { setNombre(''); setEmail(''); } }, [initial]);<br>

                &nbsp;&nbsp;<span class="kw">function</span> <span class="fn">submit</span>(e){ e.preventDefault(); onSave({ nombre, email }); }

                &nbsp;&nbsp;<span class="kw">return</span> (
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;form className="space-y-3" onSubmit={submit}&gt;
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;input className="w-full p-2 border rounded" value={nombre} onChange={e =&gt; setNombre(e.target.value)} placeholder="Nombre" required /&gt;
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;input className="w-full p-2 border rounded" value={email} onChange={e =&gt; setEmail(e.target.value)} placeholder="Email" type="email" required /&gt;
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;div className="flex gap-2"&gt;&lt;button className="px-4 py-2 bg-blue-600 text-white rounded" type="submit"&gt;Guardar&lt;/button&gt;&lt;/div&gt;
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;/form&gt;
                &nbsp;&nbsp;);
                }

            </div>
        </div>

        <div class="code-editor">
            <div class="code-toolbar"><span class="file-label">src/ClienteForm.jsx</span></div>
            <pre><code class="language-jsx">// src/ClienteForm.jsx
import { useState, useEffect } from 'react';
export default function ClienteForm({ onSave, initial = null }) {
  const [nombre, setNombre] = useState('');
  const [email, setEmail] = useState('');
  useEffect(() => { if(initial){ setNombre(initial.nombre||''); setEmail(initial.email||''); } else { setNombre(''); setEmail(''); } }, [initial]);
  function submit(e){ e.preventDefault(); onSave({ nombre, email }); }
  return (
    <form className="space-y-3" onSubmit={submit}>
      <input className="w-full p-2 border rounded" value={nombre} onChange={e => setNombre(e.target.value)} placeholder="Nombre" required />
      <input className="w-full p-2 border rounded" value={email} onChange={e => setEmail(e.target.value)} placeholder="Email" type="email" required />
      <div className="flex gap-2"><button className="px-4 py-2 bg-blue-600 text-white rounded" type="submit">Guardar</button></div>
    </form>
  );
}
</code></pre>
        </div>

        <h3 class="text-lg font-semibold text-blue-700 mt-6">4) Integración en App.jsx</h3>
        <p class="text-gray-700">En el componente principal orquestamos llamadas a la API, manejamos estado y pasamos callbacks a los componentes.</p>

        <div class="codecard editor-bg rounded-xl p-4 mb-4">
            <div class="editor-code">
                <span class="com">// src/App.jsx</span><br>
                <span class="kw">import</span> { <span class="var">useState</span>, <span class="var">useEffect</span>, <span class="var">useCallback</span> } <span class="kw">from</span> <span class="str">'react'</span>;<br>
                <span class="kw">import</span> { <span class="var">getClientes</span>, <span class="var">crearCliente</span>, <span class="var">actualizarCliente</span>, <span class="var">borrarCliente</span> } <span class="kw">from</span> <span class="str">'./api'</span>;<br>
                <span class="kw">import</span> <span class="var">ClienteForm</span> <span class="kw">from</span> <span class="str">'./ClienteForm'</span>;<br>
                <span class="kw">import</span> <span class="var">ClienteList</span> <span class="kw">from</span> <span class="str">'./ClienteList'</span>;<br>

                <span class="kw">export default function</span> <span class="fn">App</span>() {<br>
                &nbsp;&nbsp;<span class="kw">const</span> [<span class="var">clientes</span>, <span class="var">setClientes</span>] = <span class="fn">useState</span>([]);<br>
                &nbsp;&nbsp;<span class="kw">const</span> [<span class="var">editing</span>, <span class="var">setEditing</span>] = <span class="fn">useState</span>(null);<br>

                &nbsp;&nbsp;<span class="kw">useEffect</span>(() =&gt; {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;const ac = <span class="kw">new</span> <span class="var">AbortController</span>();<br>
                &nbsp;&nbsp;&nbsp;&nbsp;getClientes(ac.signal).then(data =&gt; setClientes(data)).catch(err =&gt; { if(err.name!== 'AbortError') console.error(err); });<br>
                &nbsp;&nbsp;&nbsp;&nbsp;return () =&gt; ac.abort();<br>
                &nbsp;&nbsp;}, []);

                &nbsp;&nbsp;<span class="kw">const</span> <span class="var">reload</span> = <span class="fn">useCallback</span>(() =&gt; { getClientes().then(setClientes).catch(console.error); }, []);

                &nbsp;&nbsp;<span class="kw">async function</span> <span class="fn">handleSave</span>(<span class="var">payload</span>){
                &nbsp;&nbsp;&nbsp;&nbsp;try{ if(editing) await actualizarCliente(editing.id, payload); else await crearCliente(payload); setEditing(null); reload(); }
                &nbsp;&nbsp;&nbsp;&nbsp;catch(e){ console.error(e); alert('Error guardando'); }
                }

                &nbsp;&nbsp;<span class="kw">async function</span> <span class="fn">handleDelete</span>(<span class="var">id</span>){ if(confirm('¿Borrar?')){ await borrarCliente(id); reload(); } }

                &nbsp;&nbsp;<span class="kw">return</span> (
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;div className="max-w-3xl mx-auto space-y-6"&gt;
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;h1 className="text-2xl font-bold"&gt;Clientes&lt;/h1&gt;
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;ClienteForm onSave={handleSave} initial={editing} /&gt;
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;ClienteList clientes={clientes} onEdit={setEditing} onDelete={handleDelete} /&gt;
                &nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;
                &nbsp;&nbsp;);
                }

            </div>
        </div>

        <div class="code-editor">
            <div class="code-toolbar"><span class="file-label">src/App.jsx</span></div>
            <pre><code class="language-jsx">// src/App.jsx
import { useState, useEffect, useCallback } from 'react';
import { getClientes, crearCliente, actualizarCliente, borrarCliente } from './api';
import ClienteForm from './ClienteForm';
import ClienteList from './ClienteList';

export default function App(){
  const [clientes, setClientes] = useState([]);
  const [editing, setEditing] = useState(null);
  useEffect(()=>{
    const ac = new AbortController();
    getClientes(ac.signal).then(data=>setClientes(data)).catch(err=>{ if(err.name !== 'AbortError') console.error(err); });
    return ()=> ac.abort();
  },[]);
  const reload = useCallback(()=>{ getClientes().then(setClientes).catch(console.error); }, []);
  async function handleSave(payload){ try{ if(editing) await actualizarCliente(editing.id, payload); else await crearCliente(payload); setEditing(null); reload(); } catch(e){ console.error(e); alert('Error guardando'); } }
  async function handleDelete(id){ if(confirm('¿Borrar?')){ await borrarCliente(id); reload(); } }
  return (
    <div className="max-w-3xl mx-auto space-y-6">
      <h1 className="text-2xl font-bold">Clientes</h1>
      <ClienteForm onSave={handleSave} initial={editing} />
      <ClienteList clientes={clientes} onEdit={setEditing} onDelete={handleDelete} />
    </div>
  );
}
</code></pre>
        </div>

        <h3 class="text-lg font-semibold text-blue-700 mt-6">5) Manejo de errores, loading y usabilidad</h3>
        <ul class="list-disc pl-6 text-gray-700 mb-4">
            <li>Mostrar un spinner o estado <code>loading</code> mientras se cargan los clientes.</li>
            <li>Capturar errores y mostrarlos en la UI con mensajes amigables.</li>
            <li>Usar <code>AbortController</code> para cancelar requests en unmount o en nuevas búsquedas.</li>
            <li>Deshabilitar botones mientras se realiza la petición para evitar doble envío.</li>
        </ul>

        <h3 class="text-lg font-semibold text-blue-700 mt-6">6) Optimización y buenas prácticas</h3>
        <ul class="list-disc pl-6 text-gray-700 mb-4">
            <li>Memoiza callbacks con <code>useCallback</code> y cálculos con <code>useMemo</code>.</li>
            <li>Normaliza datos en el cliente si la colección crece (por ejemplo, con un objeto id-&gt;entity).</li>
            <li>Considera SWR o React Query para caché, revalidación y sincronización del estado remoto.</li>
            <li>Centraliza las llamadas a la API en <code>src/api.js</code> para facilitar testing y cambios de endpoint.</li>
        </ul>

        <h3 class="text-lg font-semibold text-blue-700 mt-6">7) Pruebas rápidas</h3>
        <p class="text-gray-700 mb-4">Prueba manual: crea un cliente, verifica aparece en la lista; edita y confirma cambios; borra y confirma eliminación. Para tests automatizados, mockea las fetch/axios y valida que los componentes reaccionan correctamente.</p>

        <h3 class="text-lg font-semibold text-blue-700 mt-6">Resumen</h3>
        <p class="text-gray-700">Hemos implementado un cliente HTTP robusto y progresivo en React: encapsulamos solicitudes en <code>api.js</code>, creamos componentes reutilizables, manejamos errores y optimizamos con aborts y memoización. Para apps reales, valora usar React Query o SWR para un manejo más completo de sincronización y caché.</p>
    </section>
</main>
<!-- Unified footer -->
<footer class="bg-slate-900 text-white py-6">
    <div class="container mx-auto px-4 text-center">
        <p class="text-sm">&copy; 2025  Armenia, Quindío - Arle Morales Ortiz.</p>
        <p class="text-xs text-slate-400 mt-1">Hecho con ❤️ — Mejoras de accesibilidad, animaciones y usabilidad.</p>
    </div>
</footer>
<script src="./vendor/header-offset.js"></script>
</body>
</html>
