<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>React CRUD Clientes - Tutorial Paso a Paso</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <!-- Prism tema y estilos para bloques de código -->
    <link href="./vendor/prism-tomorrow.min.css" rel="stylesheet">
    <style>
        html, body {height:100%; margin:0}
        body{display:flex; flex-direction:column}
        main{flex:1 0 auto}
        footer{flex-shrink:0}
        /* Header shared styles (from index) */
        header { overflow: visible; padding-top: env(safe-area-inset-top); }
        :root { --header-offset: 9.5rem; }
        .logo-wrap { display:flex; align-items:center; gap:0.75rem; }
        .logo-circle { border-radius:9999px; background:rgba(255,255,255,0.08); display:flex; align-items:center; justify-content:center; }
        .logo-circle { padding:0.5rem; width:64px; height:64px; }
        .brand-title { font-size:1.375rem; }
        .brand-sub { font-size:0.875rem; }
        @media(min-width:640px){ .logo-circle { padding:0.75rem; width:80px; height:80px; } .brand-title { font-size:1.75rem; } .brand-sub { font-size:0.95rem; } }
        @media(min-width:1024px){ .logo-circle { padding:1rem; width:96px; height:96px; } .brand-title { font-size:2.25rem; } .brand-sub { font-size:1rem; } }

        /* Editor-like code block (similar to tema11) */
        .code-editor { position: relative; padding: 0.5rem; background: linear-gradient(180deg,#07101a 0%, #0b1220 100%); border-radius: 12px; border: 1px solid rgba(255,255,255,0.04); color: #e6eef8; margin-bottom: 1rem; box-shadow: 0 6px 18px rgba(3,7,18,0.35); }
        .code-toolbar { padding: 0.45rem 0.75rem; display:flex; align-items:center; gap:.6rem; justify-content:space-between; }
        .file-label { color:#cfe8ff; font-weight:700; font-size:0.95rem; display:inline-flex; align-items:center; gap:0.6rem; }
        .file-meta { color:#8fa9bf; font-size:0.8rem; }
        .code-actions { display:flex; gap:0.5rem; align-items:center; }
        .copy-btn { background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02)); color:#cfe8ff; border:1px solid rgba(255,255,255,0.04); padding:6px 10px; border-radius:8px; cursor:pointer; font-weight:600; font-size:0.85rem; display:inline-flex; gap:0.5rem; align-items:center; }
        .copy-btn:active { transform: translateY(1px); }
        .copy-btn:focus { outline: 2px solid rgba(125,211,252,0.18); }
        .copy-btn .icon { opacity:0.9 }
        .code-editor pre { background: transparent; color: #dbe7f6; font-size:0.92rem; line-height:1.6; padding: .6rem; margin:0; overflow:auto; border-radius:6px; font-family: 'Fira Code', 'Courier New', monospace; }
        /* Small accent bar on top-left for filename */
        .file-badge { display:inline-block; padding:4px 8px; border-radius:6px; background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.03); font-size:0.78rem; color:#c9e6ff }
        @media (max-width: 640px) { .code-editor pre { font-size:0.82rem; } .file-label { font-size:0.86rem; } }
        /* Window controls and left badge */
        .file-left { display:flex; align-items:center; gap:0.7rem; }
        .window-controls { display:inline-flex; gap:6px; align-items:center; padding:4px; }
        .window-dot { width:10px; height:10px; border-radius:9999px; display:inline-block; box-shadow: 0 1px 0 rgba(0,0,0,0.25); }
        .window-dot.red { background:#ff5f56; }
        .window-dot.yellow { background:#ffbd2e; }
        .window-dot.green { background:#27c93f; }
        .file-left .file-badge { font-size:0.78rem; padding:6px 10px; }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800">
<!-- Unified header with lesson title -->
<header class="bg-gradient-to-r from-blue-700 via-cyan-600 to-indigo-700 text-white py-8 sm:py-12 md:py-16 lg:py-20 sticky top-0 z-50 shadow-lg">
    <div class="container mx-auto px-4">
        <div class="flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="logo-wrap animate-fade-in-down">
                <div class="logo-circle">
                    <i class="fab fa-react text-cyan-200" style="font-size:2rem"></i>
                </div>
                <div>
                    <div class="brand-title font-extrabold leading-tight">Curso de Frontend - Desarrollo de software</div>
                    <p class="brand-sub mt-1 text-cyan-100/90">Guía práctica — Arle Morales Ortiz</p>
                </div>
            </div>

            <div class="text-right">
                <h1 class="text-2xl md:text-4xl font-extrabold">8. CRUD Clientes + API REST</h1>
                <div class="mt-2">
                    <a href="/src/index.html#topics" class="inline-flex items-center gap-2 bg-white shadow-sm text-blue-700 px-3 py-2 rounded-full text-sm md:text-base hover:brightness-95 focus-ring" aria-label="Ver temas">
                        <i class="fa-solid fa-book-open"></i>
                        <span>Ver Temas</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</header>

<main class="container mx-auto px-4 py-10 section-offset">
    <section class="bg-white rounded-2xl shadow p-6 md:p-8">
        <h2 class="text-2xl md:text-3xl font-semibold text-blue-800 mb-4 flex items-center gap-3"><i class="fa-solid fa-network-wired"></i> Tutorial paso a paso — Cliente HTTP en React usando <code>axios</code> (CRUD)</h2>

        <p class="text-gray-700 mb-4">Este tutorial muestra cómo consumir una API REST completa (operaciones Create, Read, Update, Delete) desde una aplicación React usando <strong>axios</strong>. Verás: instalación, cliente centralizado, componentes reutilizables, manejo de estado, errores, loading y buenas prácticas.</p>

        <ol class="list-decimal pl-6 space-y-4 text-gray-700">
            <li>
                <h3 class="text-lg font-semibold text-blue-700 mt-2">1) Instalación y preparación</h3>
                <p>Instala <code>axios</code> en tu proyecto y, opcionalmente, <code>clsx</code> para clases condicionales.</p>
                <div class="code-editor">
                    <div class="code-toolbar"><span class="file-label">Terminal</span></div>
                    <pre><code class="language-bash"># desde la carpeta del proyecto
npm install axios
# opcional: utilidades
npm install clsx
</code></pre>
                </div>
                <p class="text-sm text-slate-500">Nota: usamos npm en los ejemplos; adapta a <code>yarn</code> o <code>pnpm</code> según tu flujo.</p>
            </li>

            <li>
                <h3 class="text-lg font-semibold text-blue-700 mt-2">2) Cliente centralizado: <code>src/api.js</code></h3>
                <p>Creamos un cliente axios centralizado que configura la base URL, timeout, y maneja errores globales (interceptors). Esto facilita cambiar endpoints y probar/mocks.</p>
                <div class="code-editor">
                    <div class="code-toolbar"><span class="file-label">src/api.js</span></div>
                    <pre><code class="language-js">// src/api.js
import axios from 'axios';

const api = axios.create({
  baseURL: '/api/clientes', // ajusta según tu backend
  timeout: 8000,
  headers: { 'Content-Type': 'application/json' }
});

// Interceptor para responses: normalizar errores
api.interceptors.response.use(
  res =&gt; res,
  err =&gt; {
    // err puede venir de timeout, network o respuesta 4xx/5xx
    if (err.response) {
      // Respuesta recibida con código de estado fuera de 2xx
      const { status, data } = err.response;
      const message = data && data.message ? data.message : err.response.statusText;
      return Promise.reject({ status, message, original: err });
    }
    if (err.code === 'ECONNABORTED') {
      return Promise.reject({ status: 'timeout', message: 'La petición excedió el tiempo permitido', original: err });
    }
    return Promise.reject({ status: 'network', message: err.message, original: err });
  }
);

// Funciones CRUD
export async function getClientes(signal) {
  const res = await api.get('/', { signal });
  return res.data;
}

export async function getClienteById(id) {
  const res = await api.get(`/${id}`);
  return res.data;
}

export async function crearCliente(payload) {
  const res = await api.post('/', payload);
  return res.data;
}

export async function actualizarCliente(id, payload) {
  const res = await api.put(`/${id}`, payload);
  return res.data;
}

export async function borrarCliente(id) {
  const res = await api.delete(`/${id}`);
  return res.data;
}

export default api;
</code></pre>
                </div>
                <div class="mt-2">
                  <p class="font-medium">Explicación rápida:</p>
                  <ul class="list-disc pl-6">
                    <li><strong>axios.create</strong>: instancia con configuración por defecto (baseURL, headers, timeout).</li>
                    <li><strong>Interceptors</strong>: capturan errores globalmente y normalizan la forma en que los manejamos en los componentes.</li>
                    <li>Las funciones CRUD devuelven <code>res.data</code> para que los componentes trabajen directamente con los datos.</li>
                  </ul>
                </div>
            </li>

            <li>
                <h3 class="text-lg font-semibold text-blue-700 mt-2">3) Modelo de datos y contrato</h3>
                <p class="text-gray-700">Definamos la forma esperada de un cliente en ejemplos:</p>
                <div class="code-editor">
                    <div class="code-toolbar"><span class="file-label">Contrato (ejemplo)</span></div>
                    <pre><code class="language-json">{
  "id": "123",
  "nombre": "Juan Perez",
  "email": "juan@example.com",
  "telefono": "+57 300 0000000"
}
</code></pre>
                </div>
                <p class="text-gray-700">Mantener un contrato claro ayuda al manejo de formularios y validaciones en el cliente.</p>
            </li>

            <li>
                <h3 class="text-lg font-semibold text-blue-700 mt-2">4) Componente: <code>ClienteForm.jsx</code> (crear/editar)</h3>
                <p>Formulario controlado que acepta <code>initial</code> y un callback <code>onSave</code>. Escapamos JSX en el bloque de código para que aparezca correctamente en el HTML.</p>
                <div class="code-editor">
                    <div class="code-toolbar"><span class="file-label">src/ClienteForm.jsx</span></div>
                    <pre><code class="language-jsx">// src/ClienteForm.jsx
import { useState, useEffect } from 'react';

export default function ClienteForm({ initial = null, onSave, saving = false }) {
  const [nombre, setNombre] = useState('');
  const [email, setEmail] = useState('');
  const [telefono, setTelefono] = useState('');

  useEffect(() =&gt; {
    if (initial) {
      setNombre(initial.nombre || '');
      setEmail(initial.email || '');
      setTelefono(initial.telefono || '');
    } else {
      setNombre(''); setEmail(''); setTelefono('');
    }
  }, [initial]);

  function handleSubmit(e) {
    e.preventDefault();
    onSave({ nombre, email, telefono });
  }

  return (
    &lt;form className="space-y-3" onSubmit={handleSubmit}&gt;
      &lt;div&gt;
        &lt;label className="block text-sm font-medium text-slate-700"&gt;Nombre&lt;/label&gt;
        &lt;input className="w-full p-2 border rounded" value={nombre} onChange={e =&gt; setNombre(e.target.value)} required /&gt;
      &lt;/div&gt;
      &lt;div&gt;
        &lt;label className="block text-sm font-medium text-slate-700"&gt;Email&lt;/label&gt;
        &lt;input type="email" className="w-full p-2 border rounded" value={email} onChange={e =&gt; setEmail(e.target.value)} required /&gt;
      &lt;/div&gt;
      &lt;div&gt;
        &lt;label className="block text-sm font-medium text-slate-700"&gt;Teléfono&lt;/label&gt;
        &lt;input className="w-full p-2 border rounded" value={telefono} onChange={e =&gt; setTelefono(e.target.value)} /&gt;
      &lt;/div&gt;
      &lt;div className="flex gap-2"&gt;
        &lt;button className="px-4 py-2 bg-blue-600 text-white rounded" type="submit" disabled={saving}&gt;{saving ? 'Guardando...' : 'Guardar'}&lt;/button&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  );
}
</code></pre>
                </div>
                <div>
                  <p class="font-medium">Conceptos aplicados:</p>
                  <ul class="list-disc pl-6">
                    <li>Formulario controlado: el estado del formulario vive en React y se sincroniza con los inputs.</li>
                    <li>Prop <code>initial</code>: permite reutilizar el formulario para crear y editar.</li>
                    <li>Prop <code>saving</code>: deshabilita el botón para evitar doble envío.</li>
                  </ul>
                </div>
            </li>

            <li>
                <h3 class="text-lg font-semibold text-blue-700 mt-2">5) Componente: <code>ClienteList.jsx</code> (listar y acciones)</h3>
                <p>Lista de clientes con botones para editar y borrar. El borrado pide confirmación y notifica al contenedor principal para recargar la lista.</p>
                <div class="code-editor">
                    <div class="code-toolbar"><span class="file-label">src/ClienteList.jsx</span></div>
                    <pre><code class="language-jsx">// src/ClienteList.jsx
import React from 'react';

export default function ClienteList({ clientes = [], onEdit, onDelete, loading = false }) {
  if (loading) return &lt;div&gt;Cargando...&lt;/div&gt;;
  if (!clientes.length) return &lt;div&gt;No hay clientes.&lt;/div&gt;;

  return (
    &lt;ul className="space-y-3"&gt;
      {clientes.map(c =&gt; (
        &lt;li key={c.id} className="p-3 border rounded flex items-center justify-between"&gt;
          &lt;div&gt;
            &lt;div className="font-semibold"&gt;{c.nombre}&lt;/div&gt;
            &lt;div className="text-sm text-slate-500"&gt;{c.email} • {c.telefono}&lt;/div&gt;
          &lt;/div&gt;
          &lt;div className="flex gap-2"&gt;
            &lt;button className="px-3 py-1 bg-yellow-500 text-white rounded" onClick={() =&gt; onEdit(c)}&gt;Editar&lt;/button&gt;
            &lt;button className="px-3 py-1 bg-red-600 text-white rounded" onClick={() =&gt; onDelete(c.id)}&gt;Borrar&lt;/button&gt;
          &lt;/div&gt;
        &lt;/li&gt;
      ))}
    &lt;/ul&gt;
  );
}
</code></pre>
                </div>
                <p>Buenas prácticas: componentes puros / sin estado para renderizar listas y delegar acciones al componente padre.</p>
            </li>

            <li>
                <h3 class="text-lg font-semibold text-blue-700 mt-2">6) Componente principal: <code>App.jsx</code> (orquestador)</h3>
                <p>El componente principal se encarga de obtener la lista, manejar loading/errores, y pasar callbacks a los subcomponentes.</p>
                <div class="code-editor">
                    <div class="code-toolbar"><span class="file-label">src/App.jsx</span></div>
                    <pre><code class="language-jsx">// src/App.jsx
import { useState, useEffect, useCallback } from 'react';
import { getClientes, crearCliente, actualizarCliente, borrarCliente } from './api';
import ClienteForm from './ClienteForm';
import ClienteList from './ClienteList';

export default function App(){
  const [clientes, setClientes] = useState([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);
  const [editing, setEditing] = useState(null);
  const [saving, setSaving] = useState(false);

  const load = useCallback(async () =&gt; {
    setLoading(true); setError(null);
    try{
      const data = await getClientes();
      setClientes(data);
    }catch(err){
      console.error(err);
      setError(err.message || 'Error al cargar');
    }finally{ setLoading(false); }
  }, []);

  useEffect(()=>{ load(); }, [load]);

  async function handleSave(payload){
    setSaving(true);
    try{
      if (editing) {
        await actualizarCliente(editing.id, payload);
      } else {
        await crearCliente(payload);
      }
      setEditing(null);
      await load();
    }catch(err){
      console.error(err);
      alert(err.message || 'Error guardando');
    }finally{ setSaving(false); }
  }

  async function handleDelete(id){
    if (!confirm('¿Borrar este cliente?')) return;
    try{
      await borrarCliente(id);
      await load();
    }catch(err){
      console.error(err);
      alert(err.message || 'Error borrando');
    }
  }

  return (
    &lt;div className="max-w-3xl mx-auto space-y-6"&gt;
      &lt;h1 className="text-2xl font-bold"&gt;Clientes&lt;/h1&gt;
      &lt;ClienteForm onSave={handleSave} initial={editing} saving={saving} /&gt;
      &lt;ClienteList clientes={clientes} onEdit={setEditing} onDelete={handleDelete} loading={loading} /&gt;
      {error &amp;&amp; &lt;div className="text-red-600"&gt;{error}&lt;/div&gt;}
    &lt;/div&gt;
  );
}
</code></pre>
                </div>
                <p>Comentarios:</p>
                <ul class="list-disc pl-6 text-gray-700">
                  <li>Usamos <code>loading</code> para mostrar estados y evitar cargas duplicadas.</li>
                  <li>El patrón: operación &gt; setSaving(true) &gt; llamada API &gt; recarga o actualización local.</li>
                  <li>Se podría optimizar con React Query/SWR para caching y revalidación automática.</li>
                </ul>
            </li>

            <li>
                <h3 class="text-lg font-semibold text-blue-700 mt-2">7) Manejo de errores y UX</h3>
                <p class="text-gray-700">Puntos clave:</p>
                <ul class="list-disc pl-6 text-gray-700">
                  <li>Muestra mensajes de error amigables (no el stack trace).</li>
                  <li>Deshabilita botones durante peticiones.</li>
                  <li>Usa <code>AbortController</code> para cancelar peticiones si el componente se desmonta (axios soporta <code>signal</code>).</li>
                  <li>Considera validaciones en frontend y backend (duplicidad, formato de email, longitudes).</li>
                </ul>
            </li>

            <li>
                <h3 class="text-lg font-semibold text-blue-700 mt-2">8) Testing rápido y recomendaciones</h3>
                <p class="text-gray-700">Pruebas manuales: crea, edita, borra y valida que la lista se actualiza. Para pruebas automatizadas:</p>
                <ul class="list-disc pl-6 text-gray-700">
                  <li>Mockea las respuestas de <code>axios</code> con <code>jest.mock('axios')</code> y valida que los componentes reaccionan correctamente.</li>
                  <li>Test de integración: arranca un servidor de pruebas y usa <code>msw</code> (Mock Service Worker) para interceptar solicitudes HTTP.</li>
                </ul>
            </li>
        </ol>

        <h3 class="text-lg font-semibold text-blue-700 mt-6">Resumen y siguientes pasos</h3>
        <p class="text-gray-700">Hemos implementado un flujo completo para consumir una API REST con <code>axios</code> en React: cliente centralizado, componentes controlados, manejo de estados y errores. Para producción considera añadir caching (React Query), paginación y pruebas automatizadas.</p>
    </section>
</main>
<!-- Unified footer -->
<footer class="bg-slate-900 text-white py-6">
    <div class="container mx-auto px-4 text-center">
        <p class="text-sm">&copy; 2025  Armenia, Quindío - Arle Morales Ortiz.</p>
        <p class="text-xs text-slate-400 mt-1">Hecho con ❤️ — Mejoras de accesibilidad, animaciones y usabilidad.</p>
    </div>
</footer>
<script src="./vendor/header-offset.js"></script>
<!-- Prism y utilidades para copiado en bloques de código -->
<script>
  // Añade botones de copiar y habilita feedback. Ejecutar después de que el DOM cargue.
  (function(){
    function createCopyButton(label){
      const btn = document.createElement('button');
      btn.className = 'copy-btn';
      btn.type = 'button';
      btn.innerHTML = '<span class="icon"><i class="fa-regular fa-copy"></i></span><span class="text">'+label+'</span>';
      return btn;
    }

    function addToolbarButtons(){
      document.querySelectorAll('.code-editor').forEach(function(editor){
        const toolbar = editor.querySelector('.code-toolbar');
        if(!toolbar) return;
        // evitar duplicados
        if(toolbar.querySelector('.copy-btn')) return;

        // crear la parte izquierda (controles de ventana + badge) si no existe
        if(!toolbar.querySelector('.file-left')){
          const labelEl = toolbar.querySelector('.file-label');
          const labelText = labelEl ? labelEl.textContent.trim() : '';
          // ocultar label original (lo mantendremos en badge)
          if(labelEl) labelEl.style.display = 'none';
          const left = document.createElement('div');
          left.className = 'file-left';
          const wc = document.createElement('div');
          wc.className = 'window-controls';
          const dotR = document.createElement('span'); dotR.className = 'window-dot red';
          const dotY = document.createElement('span'); dotY.className = 'window-dot yellow';
          const dotG = document.createElement('span'); dotG.className = 'window-dot green';
          wc.appendChild(dotR); wc.appendChild(dotY); wc.appendChild(dotG);
          const badge = document.createElement('span'); badge.className = 'file-badge'; badge.textContent = labelText || 'archivo';
          left.appendChild(wc);
          left.appendChild(badge);
          toolbar.insertBefore(left, toolbar.firstChild);
        }

        const actions = document.createElement('div');
        actions.className = 'code-actions';
        const copyBtn = createCopyButton('Copiar');
        copyBtn.addEventListener('click', async function(){
          const code = editor.querySelector('pre code');
          if(!code) return;
          try{
            await navigator.clipboard.writeText(code.innerText.trim());
            const textEl = copyBtn.querySelector('.text');
            const old = textEl.textContent;
            textEl.textContent = 'Copiado';
            setTimeout(()=> textEl.textContent = old, 1500);
          }catch(e){
            console.error('copiar error', e);
          }
        });

        actions.appendChild(copyBtn);
        toolbar.appendChild(actions);
      });
    }

    // Esperar al DOM
    if(document.readyState === 'loading') document.addEventListener('DOMContentLoaded', addToolbarButtons);
    else addToolbarButtons();
  })();
</script>
<script src="./vendor/prism.min.js"></script>
</body>
</html>
